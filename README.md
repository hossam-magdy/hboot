# HBoot

A tool to enable you boot directly from multiple ISO files on a USB stick.

No need anymore for [Windows USB/DVD Download Tool](https://www.microsoft.com/en-us/download/windows-usb-dvd-download-tool), which is great tool, but eventually it extracts the Windows ISO making your USB stick unusable for any other OS installation (Ubuntu or even different other Windows ISO).

Using this tool you can have a USB stick divided into 2 partitions (Boot + Data) so you can still use the Data partition for personal storage. And even in the Boot partition will not be packed with multiple files as the ISO files are directly copied.

Once this tool is setup on a USB stick, you can copy any/all of the following ISO files, then boot from any of them:

- [ubuntu-20.04-desktop-amd64.iso](https://releases.ubuntu.com/20.04/ubuntu-20.04-desktop-amd64.iso)
- [Win10_1909_English_x64.iso](https://www.microsoft.com/en-us/software-download/windows10ISO/)
- [Win10_1909_German_x64.iso](https://www.microsoft.com/en-us/software-download/windows10ISO/)
- [Win7PE_x64.iso](https://archive.org/download/win7pe-x64/Win7PE_x64.iso) (see [screenshots](https://archive.org/details/win7pe-x64))

**Screenshot of the boot menu**

![Boot Menu Screenshot](./docs/HBoot-screenshot.png)

## Overview

A brief explanation of:

### â€œmulti-partitionâ€

USB disk will have 2 partitions:

- NTFS partition for all â€œBootâ€ files (ISO files, grldr, firadisk, â€¦)
- NTFS partition for regular â€œDataâ€ usage
- Windows OS allows access to only one partition for any removable device. So, making the â€œDataâ€ partition accessible (visible) to Windows ensures security to all boot files (the entire â€œBootâ€ partition is hidden). Even if anyone tried to format your USB disk using regular windows format, it will format only the visible partition.

So, your boot files are protected as long as you set the â€œDataâ€ partition as the visible one.

### â€œmulti-bootâ€

USB disk can boot from the following:

- Windows XP/7/10 installation ISO (you can install any version of windows)
- Windows PE (Preinstalled Environment) ISO
- Ubuntu ISO (i.e: live/installation)
- Hirenâ€™s BootCD ISO
- Ultimate BootCD ISO
- Acronis Disk Director ISO
- Acronis True Image ISO
- Norton Ghost (2003/v15) IMG/ISO
- and possibly more â€¦

## Technical details

- The **grub4dos** will be written to the MBR of the USB disk to boot from â€œ**grldr**â€ file that exists at root of any partition.
- The â€œ**menu.lst**â€ file is pre-configured and categorized based on existing ISO files. Recognized ISOâ€™s are loaded directly. Unrecognized ISOâ€™s are loaded through the boot choice â€œ**( Choose ISO )**â€ which loads â€œ**boot/menuISOFileList.lst**â€œ.
- The â€œ**boot/menuISOFileList.lst**â€ file is automatically generated by â€œ**.[ReOrganizeFiles].bat**â€œ, ideally.
- USB disk partition table will be like:
  ![Screenshot](./docs/HBoot-partition-table.png)
- Swapping/switching partitions can be done from booting options (thanks to [Steve](http://reboot.pro/topic/18610-grub4dos-setptn1g4b-batch-file-sets-a-primary-partition-as-1st-entry/)).
- â€œ**.[SwitchPartitions].bat**â€ uses an embedded â€œ**.BOOTICE.exe**â€ to modify partition table by setting parameter `/firstpart=1`.

## Steps

**CAUTION:**
Make sure your USB disk has no important data.
You take full responsibility of any data loss or HDD damage resulting from the following steps.
**However**, if you followed the guide in a step-by-step manner, no data should be lost.
DO NOT CONTINUE IF YOU DO NOT KNOW WHAT YOU ARE DOING.

1. Clone the â€œ**HBoot-Files**â€œ (this repository)
2. Using â€œ**BOOTICE.exe**â€ (in â€œ**HBoot-Tools.zip**â€œ), follow the screenshot below (blue marks are optional/changeable):

   ![Tutorial](./docs/HBoot-tutorial-windows.png)

3. Copy the ISO files to the boot partition

   (preferable by _dragNdrop_ over â€œ**.[ReOrganizeFiles].bat**â€œ)

   (download links can be found at the beginning of â€œ**menu.lst**â€œ)

4. Run â€œ**.[ReOrganizeFiles].bat**â€ to ensure ISO contigousiness (i.e: defragemented) & to protect boot files.

## Notes

- Using â€œ**.[SwitchPartitions].bat**â€ you can switch/swap between â€œBootâ€ and â€œDataâ€ partitions.

  You can switch also using â€œBOOTICEâ€ => â€œParts Manageâ€ => â€œSet Accessibleâ€

- Using â€œ**.[ReOrganizeFiles].bat**â€ you can:
  - Copy files **contiguously** (if possible) by opening/dragging-dropping them with the â€œ**.[ReOrganizeFiles].bat**â€ file.
  - Verify that all **ISO** files are **contiguous** (must be so, to boot).
  - Hide/protect critical boot files & show/unhide all other files (useful in case of some malware infection).
  - Remove (from root folder only) :
    - shortcut files (\*.lnk)
    - vbScript files (\*.vbs)
    - JavaScript files (\*.js)
    - â€œAutorun.infâ€ file created by some malwares
    - â€œSystem Volume Informationâ€ folder
    - â€œRecyclerâ€ folder
    - â€œRECYCLEâ€ file/folder created by some malwares
  - Rebuild â€œ**Autorun.inf**â€ file for elegant USB icon (also overwrites the inf file created by some malwares)
- Any ISO file must be placed at the root of the â€œBootâ€ partition.
- Some ISO files are pre-configured for booting, to make use of this, ISO file name should be as configured in â€œ**menu.lst**â€ (for advanced users)

I hope this would be useful to someone.

Good Luck ğŸ˜‰

### Hint:

This _tutorial_ was used to be a [blog post](https://hossam6236.wordpress.com/2016/09/03/hboot-multi-partition-multi-boot-from-iso-files-usb-install-windows-7-10-windowspe-boot-iso/) since 2016, but is moved to a git repo for:

- tracking changes of `menu.lst` due to new releases of Windows and Ubuntu
- easier maintenance of files here than google drive
